(this["webpackJsonpgraphql-chess-app"]=this["webpackJsonpgraphql-chess-app"]||[]).push([[0],{19:function(e,t,n){e.exports=n(34)},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),s=n(4),i=n(2),u=n(17),l=(n(30),n(31),n(32),n(5));function f(e){return e.chess}function p(e){return e.gameLog}function d(e){var t=e.ui.selectedSquareId;if(!t)return null;var n=e.chess.squares.find((function(e){return e.id===t})),a=e.chess.movesBySquare[n.id],r=null===a||void 0===a?void 0:a.map((function(e){return e.to}));return Object(l.a)(Object(l.a)({},n),{},{targets:r})}var b=n(1),m="chess/REQUEST",v="chess/RECEIVE",h="chess/FAILURE",O="move/REQUEST",E="move/RECEIVE",g="move/FAILURE",j="\n  fragment ChessAttributes on Chess {\n      analysis {\n        bestMove {\n          from\n          to\n          flags\n        }\n        ponderMove {\n          from\n          to\n          flags\n        }\n      }\n      board {\n        rank\n        squares {\n          file\n          piece {\n            type\n            color\n          }\n        }\n      }\n      fen\n      gameOver\n      inCheck\n      inCheckmate\n      inDraw\n      inStalemate\n      insufficientMaterial\n      inThreefoldRepetition\n      moves {\n        color\n        from\n        to\n        promotion\n        flags\n      }\n      turn\n  }\n",y="\n  ".concat(j,"\n  {\n    chess {\n      ... ChessAttributes\n    }\n  }\n"),k="\n  ".concat(j,"\n\n  mutation makeMove($fen: String!, $move: MoveObjectInput!){\n    chess: move (input: {\n      fen: $fen,\n      move: $move\n    }) {\n      ... ChessAttributes\n    }\n  }\n");function I(e){return{type:"PIECE_SELECTED",squareId:e}}function q(e,t){return Object(b.a)({},"CALL_API",{query:k,variables:{fen:e,move:t},types:[O,E,g]})}function C(e){return Object(a.useEffect)((function(){e(Object(b.a)({},"CALL_API",{query:y,types:[m,v,h]}))}),[e])}var w,A,L,T,S,N,B,K=n(3),H=n.n(K),P=n(6),W=n(7),x={WHITE:"w",BLACK:"b"},M=new Map(Object.entries(x).map((function(e){var t=Object(W.a)(e,2),n=t[0];return[t[1],n]}))),R=x.WHITE,D=x.BLACK,G=x,U={PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k"},_=new Map(Object.entries(U).map((function(e){var t=Object(W.a)(e,2),n=t[0];return[t[1],n]}))),Q=U;var $=(B={},Object(b.a)(B,Q.KING,(w={},Object(b.a)(w,G.BLACK,"\u265a"),Object(b.a)(w,G.WHITE,"\u265a"),w)),Object(b.a)(B,Q.QUEEN,(A={},Object(b.a)(A,G.BLACK,"\u265b"),Object(b.a)(A,G.WHITE,"\u265b"),A)),Object(b.a)(B,Q.ROOK,(L={},Object(b.a)(L,G.BLACK,"\u265c"),Object(b.a)(L,G.WHITE,"\u265c"),L)),Object(b.a)(B,Q.BISHOP,(T={},Object(b.a)(T,G.BLACK,"\u265d"),Object(b.a)(T,G.WHITE,"\u265d"),T)),Object(b.a)(B,Q.KNIGHT,(S={},Object(b.a)(S,G.BLACK,"\u265e"),Object(b.a)(S,G.WHITE,"\u265e"),S)),Object(b.a)(B,Q.PAWN,(N={},Object(b.a)(N,G.BLACK,"\u265f"),Object(b.a)(N,G.WHITE,"\u265f"),N)),B);function F(e){var t=e.squareId,n=e.piece,a=e.isDark,c=e.isActive,o=e.targetedBy,s=e.onClick,i=null,u="".concat(t," is empty"),l=["chess-board-square","chess-board-square--".concat(t)];return a&&l.push("chess-board-square--dark"),s&&l.push("chess-board-square--clickable"),n&&(i=$[n.type][n.color],u="".concat(t," contains a ").concat(M.get(n.color)," ").concat(_.get(n.type)),n.color===G.BLACK&&l.push("chess-board-square--black-piece")),c&&(l.push("chess-board-square--active"),u="".concat(t," contains a ").concat(M.get(n.color)," ").concat(_.get(n.type)," selected for move. Use the tab keys to select a square to initiate move."," "," Press again to cancel selection.")),o&&(l.push("chess-board-square--targeted"),u="Move ".concat(_.get(o.piece.type)," on ").concat(o.id," ").concat(n?"to capture ".concat(_.get(n.type)," on ").concat(t):"to ".concat(t))),r.a.createElement("button",{type:"button","aria-label":u,"aria-pressed":c,disabled:!s,className:l.join(" "),onClick:function(){return s(t)}},i)}function V(){var e=Object(i.c)(f),t=Object(i.c)(d),n=Object(i.b)(),c=function(e){return Object(a.useCallback)((function(t){return e(I(t))}),[e])}(n),o=function(e,t,n){return Object(a.useCallback)((function(a){var r=t.moves.filter((function(e){return e.from===n.id})).find((function(e){return e.to===a})),c=r.from,o=r.to,s=r.promotion;s&&(s=Q.QUEEN),e(q(t.fen,{from:c,to:o,promotion:s}))}),[e,t,n])}(n,e,t);if(!e)return r.a.createElement("div",{className:"chess-board--loading"});var s=["chess-board"];return e.turn===G.BLACK&&s.push("chess-board--black-turn"),r.a.createElement("div",{className:s.join(" ")},e.squares.map((function(n){var a,s=n.id,i=n.piece,u=n.isDark,l=s===(null===t||void 0===t?void 0:t.id),f=e.turn==R,p=null===t||void 0===t||null===(a=t.targets)||void 0===a?void 0:a.includes(s),d=p?t:null,b=f?p?o:i?c:null:null;return r.a.createElement(F,{key:s,piece:i,squareId:s,isDark:u,isActive:l,targetedBy:d,onClick:b})})))}function J(){var e=Object(i.c)(p),t=Object(a.useRef)(null);return function(e){Object(a.useEffect)((function(){e.current.scrollTop=e.current.scrollHeight}),[e])}(t),r.a.createElement("div",{ref:t,className:"console",role:"log"},r.a.createElement("ul",{className:"console-output","aria-live":"polite","aria-atomic":"false"},null===e||void 0===e?void 0:e.map((function(e,t){return r.a.createElement("li",{key:t,className:"console-output-item"},"[",r.a.createElement("time",{dateTime:e.time},e.time),"] ",e.message)}))))}function z(){var e=Object(i.b)(),t=Object(i.c)(f);return C(e),function(e,t){Object(a.useEffect)((function(){function n(){return(n=Object(P.a)(H.a.mark((function n(){var a,r,c,o,s,i,u,l,f;return H.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=t.fen,r=t.moves,c=t.analysis,o=null,(null===c||void 0===c?void 0:c.bestMove)?(s=c.bestMove,o=r.find((function(e){return e.from===s.from&&e.to===s.to}))):o=r[0],u=(i=o).from,l=i.to,(f=i.promotion)&&(f=Q.QUEEN),e(I(u)),n.next=8,new Promise((function(e){return setTimeout(e,1e3)}));case 8:e(q(a,{from:u,to:l,promotion:f}));case 9:case"end":return n.stop()}}),n)})))).apply(this,arguments)}(null===t||void 0===t?void 0:t.turn)===D&&function(){n.apply(this,arguments)}()}),[e,t])}(e,t),r.a.createElement(r.a.Fragment,null,r.a.createElement(V,null),r.a.createElement(J,null))}var X=n(8),Y=function(e){var t=function(e){return e.moves.reduce((function(e,t){var n=e[t.from]||[];return Object(l.a)(Object(l.a)({},e),{},Object(b.a)({},t.from,[].concat(Object(X.a)(n),[t])))}),{})}(e),n=function(e){return e.board.reduce((function(e,t){var n=t.squares.map((function(e,n){return{piece:e.piece,id:"".concat(e.file).concat(t.rank),isDark:t.rank%2?!(n%2):n%2}}));return[].concat(Object(X.a)(e),Object(X.a)(n))}),[])}(e);return Object(l.a)(Object(l.a)({},e),{},{squares:n,movesBySquare:t})};var Z={loading:!0};var ee=n(18),te=[];var ne={selectedSquareId:null};var ae=Object(s.combineReducers)({chess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:case E:return Y(t.data.chess);default:return e}},appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return{loading:!0};case v:case E:return{loading:!1};case h:return{loading:!1,errors:t.errors};default:return e}},gameLog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"EVENT_LOGGED":return[].concat(Object(X.a)(e),[{time:Object(ee.a)(new Date,"HH:mm:ss"),message:t.data}]);default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIECE_SELECTED":var n=t.squareId===e.selectedSquareId;return{selectedSquareId:n?null:t.squareId};case E:return{selectedSquareId:null};default:return e}}}),re={"Content-Type":"application/json"};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ce=[function(){return function(e){return function(){var t=Object(P.a)(H.a.mark((function t(n){var a,r,c,o,s,i,u,l,f,p,d,b,m,v,h;return H.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.CALL_API){t.next=2;break}return t.abrupt("return",e(n));case 2:return a=n.CALL_API,r=a.query,c=a.variables,o=Object(W.a)(a.types,3),s=o[0],i=o[1],u=o[2],l={query:r,variables:c},f=JSON.stringify(l),p={method:"POST",headers:re,body:f},e({type:s,data:{query:r,variables:c}}),t.prev=7,t.next=10,fetch("https://fast-castle-57354.herokuapp.com",p);case 10:if(!(d=t.sent).ok){t.next=20;break}return t.next=14,d.json();case 14:b=t.sent,m=b.data,v=b.errors,m&&e({type:i,data:m}),v&&e({type:u,errors:v}),t.next=21;break;case 20:throw new Error("Response not ok");case 21:t.next=28;break;case 23:t.prev=23,t.t0=t.catch(7),h=t.t0,t.t0 instanceof Error&&(h={name:t.t0.name,message:t.t0.message,stack:t.t0.stack}),e({type:u,errors:[h]});case 28:case"end":return t.stop()}}),t,null,[[7,23]])})));return function(e){return t.apply(this,arguments)}}()}},function(e){return function(t){return function(){var n=Object(P.a)(H.a.mark((function n(a){var r,c,o,s,i,u,l;return H.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=function(t){e.dispatch({type:"EVENT_LOGGED",data:t})},n.t0=a.type,n.next=n.t0===m?4:n.t0===v?6:n.t0===h?8:n.t0===O?10:n.t0===E?18:21;break;case 4:return r("Initializing game..."),n.abrupt("break",22);case 6:return r("Game ready"),n.abrupt("break",22);case 8:return r("Failed to start game"),n.abrupt("break",22);case 10:return c=a.data.variables.move,o=e.getState(),s=o.chess.squares.find((function(e){return e.id===c.from})),i=o.chess.squares.find((function(e){return e.id===c.to})),u=null,u=i.piece?"\n          ".concat(M.get(s.piece.color)," ").concat(_.get(s.piece.type)," on ").concat(s.id," captures ").concat(_.get(i.piece.type)," on ").concat(i.id):"\n          ".concat(M.get(s.piece.color)," ").concat(_.get(s.piece.type)," moves from ").concat(s.id," to ").concat(i.id),r(u),n.abrupt("break",22);case 18:return(l=a.data.chess).inCheckmate?r("".concat(M.get(l.turn)," is in checkmate")):l.inCheck&&r("".concat(M.get(l.turn)," is in check")),n.abrupt("break",22);case 21:return n.abrupt("break",22);case 22:t(a);case 23:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}}],oe=Object(u.composeWithDevTools)(s.applyMiddleware.apply(void 0,ce)),se=Object(s.createStore)(ae,oe);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,{store:se},r.a.createElement(z,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[19,1,2]]]);
//# sourceMappingURL=main.52476810.chunk.js.map