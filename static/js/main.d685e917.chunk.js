(this["webpackJsonpgraphql-chess-app"]=this["webpackJsonpgraphql-chess-app"]||[]).push([[0],{19:function(e,t,n){e.exports=n(34)},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},34:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),s=n(4),i=n(2),u=n(17),l=(n(30),n(31),n(32),n(1)),p="chess/REQUEST",d="chess/RECEIVE",f="chess/FAILURE",b="move/REQUEST",v="move/RECEIVE",m="move/FAILURE",h="\n  fragment ChessAttributes on Chess {\n      analysis {\n        bestMove {\n          from\n          to\n          flags\n        }\n        ponderMove {\n          from\n          to\n          flags\n        }\n      }\n      board {\n        rank\n        squares {\n          file\n          piece {\n            type\n            color\n          }\n        }\n      }\n      fen\n      gameOver\n      inCheck\n      inCheckmate\n      inDraw\n      inStalemate\n      insufficientMaterial\n      inThreefoldRepetition\n      moves {\n        color\n        from\n        to\n        promotion\n        flags\n      }\n      turn\n  }\n",E="\n  ".concat(h,"\n  {\n    chess {\n      ... ChessAttributes\n    }\n  }\n"),O="\n  ".concat(h,"\n\n  mutation makeMove($fen: String!, $move: MoveObjectInput!){\n    chess: move (input: {\n      fen: $fen,\n      move: $move\n    }) {\n      ... ChessAttributes\n    }\n  }\n");function g(e){return{type:"PIECE_SELECTED",squareId:e}}function j(e,t){return Object(l.a)({},"CALL_API",{query:O,variables:{fen:e,move:t},types:[b,v,m]})}var y=n(5);function k(e){var t=e.ui.selectedSquareId;if(!t)return null;var n=e.chess.squares.find((function(e){return e.id===t})),a=e.chess.movesBySquare[n.id],r=null===a||void 0===a?void 0:a.map((function(e){return e.to}));return Object(y.a)(Object(y.a)({},n),{},{targets:r})}var I,q,C,L,w,A,T,S=n(7),N={PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k"},B=new Map(Object.entries(N).map((function(e){var t=Object(S.a)(e,2),n=t[0];return[t[1],n]}))),K=N,G={WHITE:"w",BLACK:"b"},x=new Map(Object.entries(G).map((function(e){var t=Object(S.a)(e,2),n=t[0];return[t[1],n]}))),D=G.BLACK,H=G,P=(T={},Object(l.a)(T,K.KING,(I={},Object(l.a)(I,H.BLACK,"\u265a"),Object(l.a)(I,H.WHITE,"\u2654"),I)),Object(l.a)(T,K.QUEEN,(q={},Object(l.a)(q,H.BLACK,"\u265b"),Object(l.a)(q,H.WHITE,"\u2655"),q)),Object(l.a)(T,K.ROOK,(C={},Object(l.a)(C,H.BLACK,"\u265c"),Object(l.a)(C,H.WHITE,"\u2656"),C)),Object(l.a)(T,K.BISHOP,(L={},Object(l.a)(L,H.BLACK,"\u265d"),Object(l.a)(L,H.WHITE,"\u2657"),L)),Object(l.a)(T,K.KNIGHT,(w={},Object(l.a)(w,H.BLACK,"\u265e"),Object(l.a)(w,H.WHITE,"\u2658"),w)),Object(l.a)(T,K.PAWN,(A={},Object(l.a)(A,H.BLACK,"\u265f"),Object(l.a)(A,H.WHITE,"\u2659"),A)),T);function W(e){var t=e.squareId,n=e.piece,a=e.isDark,c=e.isActive,o=e.targetedBy,s=e.onClick,i=null,u="".concat(t," is empty"),l=["chess-board-square"];return a&&l.push("chess-board-square--dark"),n&&(i=P[n.type][n.color],u="".concat(t," contains a ").concat(x.get(n.color)," ").concat(B.get(n.type)),n.color===H.BLACK&&l.push("chess-board-square--black-piece")),c&&(l.push("chess-board-square--active"),u="".concat(t," contains a ").concat(x.get(n.color)," ").concat(B.get(n.type)," selected for move. Use the tab keys to select a square to initiate move."," "," Press again to cancel selection.")),o&&(l.push("chess-board-square--targeted"),u="Move ".concat(B.get(o.piece.type)," on ").concat(o.id," ").concat(n?"to capture ".concat(B.get(n.type)," on ").concat(t):"to ".concat(t))),r.a.createElement("button",{type:"button","aria-label":u,disabled:!s,className:l.join(" "),onClick:function(){return s(t)}},i)}function M(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.chess})),n=Object(i.c)(k),c=Object(a.useCallback)((function(t){return e(g(t))}),[e]),o=Object(a.useCallback)((function(a){var r=t.moves.filter((function(e){return e.from===n.id})).find((function(e){return e.to===a})),c=r.from,o=r.to,s=r.promotion;s&&(s=K.QUEEN),e(j(t.fen,{from:c,to:o,promotion:s}))}),[e,t,n]);if(!t)return r.a.createElement("div",{className:"chess-board--loading"});var s=["chess-board"];return t.turn===H.BLACK&&s.push("chess-board--black-turn"),r.a.createElement("div",{className:s.join(" ")},t.squares.map((function(e){var t,a=e.id,s=e.piece,i=e.isDark,u=a===(null===n||void 0===n?void 0:n.id),l=null===n||void 0===n||null===(t=n.targets)||void 0===t?void 0:t.includes(a),p=l?n:null,d=l?o:s?c:null;return r.a.createElement(W,{key:a,piece:s,squareId:a,isDark:i,isActive:u,targetedBy:p,onClick:d})})))}function R(){var e=Object(i.c)((function(e){return e.gameLog}));return r.a.createElement("div",{className:"console",role:"log"},r.a.createElement("ul",{className:"console-output","aria-live":"polite","aria-atomic":"false"},null===e||void 0===e?void 0:e.map((function(e,t){return r.a.createElement("li",{key:t,className:"console-output-item"},e)}))))}function _(){var e=Object(i.b)();return Object(a.useEffect)((function(){e(Object(l.a)({},"CALL_API",{query:E,types:[p,d,f]}))}),[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement(M,null),r.a.createElement(R,null))}var U=n(8),V=function(e){var t=function(e){return e.moves.reduce((function(e,t){var n=e[t.from]||[];return Object(y.a)(Object(y.a)({},e),{},Object(l.a)({},t.from,[].concat(Object(U.a)(n),[t])))}),{})}(e),n=function(e){return e.board.reduce((function(e,t){var n=t.squares.map((function(e,n){return{piece:e.piece,id:"".concat(e.file).concat(t.rank),isDark:t.rank%2?!(n%2):n%2}}));return[].concat(Object(U.a)(e),Object(U.a)(n))}),[])}(e);return Object(y.a)(Object(y.a)({},e),{},{squares:n,movesBySquare:t})};var Q={loading:!0};var $=[];var F={selectedSquareId:null};var J=Object(s.combineReducers)({chess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d:case v:return V(t.data.chess);default:return e}},appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p:return{loading:!0};case d:case v:return{loading:!1};case f:return{loading:!1,errors:t.errors};default:return e}},gameLog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"EVENT_LOGGED":return[].concat(Object(U.a)(e),[t.data]);default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIECE_SELECTED":var n=t.squareId===e.selectedSquareId;return{selectedSquareId:n?null:t.squareId};case v:return{selectedSquareId:null};default:return e}}}),z=n(3),X=n.n(z),Y=n(6),Z={"Content-Type":"application/json"},ee=n(18),te=function(e){return"[".concat(Object(ee.a)(new Date,"HH:mm:ss"),"] ").concat(e)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ne=[function(){return function(e){return function(){var t=Object(Y.a)(X.a.mark((function t(n){var a,r,c,o,s,i,u,l,p,d,f,b,v,m,h;return X.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.CALL_API){t.next=2;break}return t.abrupt("return",e(n));case 2:return a=n.CALL_API,r=a.query,c=a.variables,o=Object(S.a)(a.types,3),s=o[0],i=o[1],u=o[2],l={query:r,variables:c},p=JSON.stringify(l),d={method:"POST",headers:Z,body:p},e({type:s,data:{query:r,variables:c}}),t.prev=7,t.next=10,fetch("https://fast-castle-57354.herokuapp.com",d);case 10:if(!(f=t.sent).ok){t.next=20;break}return t.next=14,f.json();case 14:b=t.sent,v=b.data,m=b.errors,v&&e({type:i,data:v,variables:c}),m&&e({type:u,errors:m}),t.next=21;break;case 20:throw new Error("Response not ok");case 21:t.next=28;break;case 23:t.prev=23,t.t0=t.catch(7),h=t.t0,t.t0 instanceof Error&&(h={name:t.t0.name,message:t.t0.message,stack:t.t0.stack}),e({type:u,errors:[h]});case 28:case"end":return t.stop()}}),t,null,[[7,23]])})));return function(e){return t.apply(this,arguments)}}()}},function(e){return function(t){return function(){var n=Object(Y.a)(X.a.mark((function n(a){var r,c,o,s,i,u,l;return X.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t(a),a.type!==v){n.next=8;break}if(r=e.getState(),c=r.chess,o=c.fen,s=c.turn,i=c.analysis.bestMove,u=i.from,l=i.to,s!==D){n.next=8;break}return e.dispatch(g(u)),n.next=7,new Promise((function(e){return setTimeout(e,1e3)}));case 7:e.dispatch(j(o,{from:u,to:l}));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}},function(e){return function(t){return function(){var n=Object(Y.a)(X.a.mark((function n(a){var r,c,o,s,i;return X.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=a.type,n.next=n.t0===p?3:n.t0===d?5:n.t0===f?7:n.t0===v?9:17;break;case 3:return e.dispatch({type:"EVENT_LOGGED",data:te("Initializing game...")}),n.abrupt("break",18);case 5:return e.dispatch({type:"EVENT_LOGGED",data:te("Game ready")}),n.abrupt("break",18);case 7:return e.dispatch({type:"EVENT_LOGGED",data:te("Failed to start game")}),n.abrupt("break",18);case 9:return r=a.variables.move,c=e.getState(),o=c.chess.squares.find((function(e){return e.id===r.from})),s=c.chess.squares.find((function(e){return e.id===r.to})),i=null,i=s.piece?"\n          ".concat(x.get(o.piece.color)," ").concat(B.get(o.piece.type)," on ").concat(o.id," captures ").concat(B.get(s.piece.type)," on ").concat(s.id):"\n          ".concat(x.get(o.piece.color)," ").concat(B.get(o.piece.type)," moves from ").concat(o.id," to ").concat(s.id),e.dispatch({type:"EVENT_LOGGED",data:te(i)}),n.abrupt("break",18);case 17:return n.abrupt("break",18);case 18:t(a);case 19:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()}}],ae=Object(u.composeWithDevTools)(s.applyMiddleware.apply(void 0,ne)),re=Object(s.createStore)(J,ae);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.a,{store:re},r.a.createElement(_,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[19,1,2]]]);
//# sourceMappingURL=main.d685e917.chunk.js.map