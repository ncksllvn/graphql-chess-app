(this["webpackJsonpgraphql-chess-app"]=this["webpackJsonpgraphql-chess-app"]||[]).push([[0],{12:function(e,t,n){e.exports=n(20)},17:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n(0),c=n.n(r),o=n(10),i=n.n(o),u=(n(17),n(18),"chess/REQUEST"),s="chess/RECEIVE",l="chess/FAILURE",v="move/REQUEST",d="move/RECEIVE",f="move/FAILURE",b=c.a.createContext(null);function m(){return Object(r.useContext)(b)}var p=c.a.createContext(null);function O(e){var t=Object(r.useContext)(p);return c.a.useMemo((function(){return e(t)}),[e,t])}function h(e){return e.appStatus}function j(e){return e.chess}function g(e){return e.gameLog}function E(e){return e.ui}var k="\n  fragment ChessAttributes on Chess {\n      analysis {\n        bestMove {\n          from\n          to\n          flags\n        }\n        ponderMove {\n          from\n          to\n          flags\n        }\n      }\n      board {\n        rank\n        squares {\n          file\n          piece {\n            type\n            color\n          }\n        }\n      }\n      fen\n      gameOver\n      inCheck\n      inCheckmate\n      inDraw\n      inStalemate\n      insufficientMaterial\n      inThreefoldRepetition\n      moves {\n        color\n        from\n        to\n        promotion\n        flags\n      }\n      turn\n  }\n",y="\n  ".concat(k,"\n  {\n    chess {\n      ... ChessAttributes\n    }\n  }\n"),C="\n  ".concat(k,"\n\n  mutation makeMove($fen: String!, $move: MoveObjectInput!){\n    chess: move (input: {\n      fen: $fen,\n      move: $move\n    }) {\n      ... ChessAttributes\n    }\n  }\n"),q=n(4),I=n.n(q),T=n(8),w={WHITE:"w",BLACK:"b"},S=new Map(Object.entries(w).map((function(e){var t=Object(a.a)(e,2),n=t[0];return[t[1],n]}))),A=w.WHITE,N=w.BLACK,B=w;function L(){var e=m();return c.a.useCallback((function(t){return e({type:"PIECE_SELECTED",squareId:t})}),[e])}var M={PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k"},K=new Map(Object.entries(M).map((function(e){var t=Object(a.a)(e,2),n=t[0];return[t[1],n]}))),H=M,x={"Content-Type":"application/json"};function R(){var e=m();return Object(r.useCallback)(function(){var t=Object(T.a)(I.a.mark((function t(n){var r,c,o,i,u,s,l,v,d,f,b,m,p,O,h;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.query,c=n.variables,o=n.types,i=Object(a.a)(o,3),u=i[0],s=i[1],l=i[2],v={query:r,variables:c},d=JSON.stringify(v),f={method:"POST",headers:x,body:d},e({type:u,data:{query:r,variables:c}}),t.prev=6,t.next=9,fetch("https://fast-castle-57354.herokuapp.com",f);case 9:if(!(b=t.sent).ok){t.next=18;break}return t.next=13,b.json();case 13:m=t.sent,p=m.data,O=m.errors,e({type:s,data:p,errors:O}),t.next=19;break;case 18:throw new Error("Response not ok");case 19:t.next=26;break;case 21:t.prev=21,t.t0=t.catch(6),h=t.t0,t.t0 instanceof Error&&(h={name:t.t0.name,message:t.t0.message,stack:t.t0.stack}),e({type:l,errors:[h]});case 26:case"end":return t.stop()}}),t,null,[[6,21]])})));return function(e){return t.apply(this,arguments)}}(),[e])}function W(){var e=R();return Object(r.useCallback)((function(t,n,a){var r=t.moves.find((function(e){return e.from===n&&e.to===a})),c=r.from,o=r.to,i=r.promotion;i&&(i=H.QUEEN),e({query:C,variables:{fen:t.fen,move:{from:c,to:o,promotion:i}},types:[v,d,f]})}),[e])}var P=n(2);var D,G,U,z,Q,$,_,V=n(1),F=(_={},Object(V.a)(_,H.KING,(D={},Object(V.a)(D,B.BLACK,"\u265a"),Object(V.a)(D,B.WHITE,"\u2654"),D)),Object(V.a)(_,H.QUEEN,(G={},Object(V.a)(G,B.BLACK,"\u265b"),Object(V.a)(G,B.WHITE,"\u2655"),G)),Object(V.a)(_,H.ROOK,(U={},Object(V.a)(U,B.BLACK,"\u265c"),Object(V.a)(U,B.WHITE,"\u2656"),U)),Object(V.a)(_,H.BISHOP,(z={},Object(V.a)(z,B.BLACK,"\u265d"),Object(V.a)(z,B.WHITE,"\u2657"),z)),Object(V.a)(_,H.KNIGHT,(Q={},Object(V.a)(Q,B.BLACK,"\u265e"),Object(V.a)(Q,B.WHITE,"\u2658"),Q)),Object(V.a)(_,H.PAWN,($={},Object(V.a)($,B.BLACK,"\u265f"),Object(V.a)($,B.WHITE,"\u2659"),$)),_);var J=c.a.memo((function(e){var t=e.squareId,n=e.piece,a=e.isDark,r=e.isActive,o=e.targetedBy,i=e.onClick,u=null,s="".concat(t," is empty"),l=["chess-board-square","chess-board-square--".concat(t)];return a&&l.push("chess-board-square--dark"),i&&l.push("chess-board-square--clickable"),n&&(u=F[n.type][n.color],s="".concat(t," contains a ").concat(S.get(n.color)," ").concat(K.get(n.type)),n.color===B.BLACK&&l.push("chess-board-square--black-piece")),r&&(l.push("chess-board-square--active"),s="".concat(t," contains a ").concat(S.get(n.color)," ").concat(K.get(n.type)," selected for move. Use the tab keys to select a square to initiate move."," "," Press again to cancel selection.")),o&&(l.push("chess-board-square--targeted"),s="Move ".concat(K.get(o.piece.type)," on ").concat(o.id," ").concat(n?"to capture ".concat(K.get(n.type)," on ").concat(t):"to ".concat(t))),c.a.createElement("button",{type:"button","aria-label":s,"aria-pressed":r,disabled:!i,className:l.join(" "),onClick:function(){return i(t)}},u)}));function X(){var e=O(j),t=function(){var e=O(j),t=O(E).selectedSquareId,n=null===e||void 0===e?void 0:e.squares,a=null===e||void 0===e?void 0:e.movesBySquare;return c.a.useMemo((function(){if(!t)return null;var e=n.find((function(e){return e.id===t})),r=a[e.id],c=null===r||void 0===r?void 0:r.map((function(e){return e.to}));return Object(P.a)(Object(P.a)({},e),{},{targets:c})}),[t,n,a])}(),n=L(),a=W();if(!e)return c.a.createElement("div",{className:"chess-board--loading"});var r=["chess-board"];return e.turn===B.BLACK&&r.push("chess-board--black-turn"),c.a.createElement("div",{className:r.join(" ")},e.squares.map((function(r){var o,i=r.id,u=r.piece,s=r.isDark,l=i===(null===t||void 0===t?void 0:t.id),v=e.turn===A,d=null===t||void 0===t||null===(o=t.targets)||void 0===o?void 0:o.includes(i),f=d?t:null,b=null;return v&&(d?b=function(n){return a(e,t.id,n)}:(null===u||void 0===u?void 0:u.color)===A&&(b=function(e){return n(e)})),c.a.createElement(J,{key:i,piece:u,squareId:i,isDark:s,isActive:l,targetedBy:f,onClick:b})})))}function Y(){var e=O(g),t=Object(r.useRef)(null);return function(){var e=m(),t=O(h),n=O(j),a=O(E),c=Object(r.useCallback)((function(t){e({type:"EVENT_LOGGED",data:t})}),[e]),o=Object(r.useCallback)((function(e){var t=n.squares.find((function(t){return t.id===e.from})),a=n.squares.find((function(t){return t.id===e.to})),r=null;r=a.piece?"\n          ".concat(S.get(t.piece.color)," ").concat(K.get(t.piece.type)," on ").concat(t.id," captures ").concat(K.get(a.piece.type)," on ").concat(a.id):"\n          ".concat(S.get(t.piece.color)," ").concat(K.get(t.piece.type)," moves from ").concat(t.id," to ").concat(a.id),c(r)}),[n,c]),i=null===n||void 0===n?void 0:n.inCheckmate,u=null===n||void 0===n?void 0:n.inCheck;Object(r.useEffect)((function(){t.initializing?c("initializing game..."):c("game ready")}),[c,t.initializing]),Object(r.useEffect)((function(){a.pendingMove&&o(a.pendingMove)}),[a.pendingMove,o]),Object(r.useEffect)((function(){i?c("".concat(S.get(n.turn)," is in checkmate")):u&&c("".concat(S.get(n.turn)," is in check"))}),[i,u,c])}(),function(e,t){Object(r.useEffect)((function(){e.current.scrollTop=e.current.scrollHeight}),[e,t])}(t,e),c.a.createElement("div",{ref:t,className:"console",role:"log"},c.a.createElement("ul",{className:"console-output","aria-live":"polite","aria-atomic":"false"},null===e||void 0===e?void 0:e.map((function(e,t){return c.a.createElement("li",{key:t,className:"console-output-item"},"[",c.a.createElement("time",{dateTime:e.time},e.time),"] ",e.message)}))))}function Z(){var e=R();return Object(r.useEffect)((function(){e({query:y,types:[u,s,l]})}),[e]),function(){var e=O(j),t=null===e||void 0===e?void 0:e.turn,n=null===e||void 0===e?void 0:e.gameOver,a=L(),c=W(),o=Object(r.useCallback)(Object(T.a)(I.a.mark((function t(){var n,r,o,i;return I.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.moves,o=e.analysis,i=null!==(n=null===o||void 0===o?void 0:o.bestMove)&&void 0!==n?n:r[0],a(i.from),t.next=5,new Promise((function(e){return setTimeout(e,1e3)}));case 5:c(e,i.from,i.to);case 6:case"end":return t.stop()}}),t)}))),[e,a,c]);Object(r.useEffect)((function(){n||t!==N||o()}),[o,n,t])}(),c.a.createElement(c.a.Fragment,null,c.a.createElement(X,null),c.a.createElement(Y,null))}var ee=n(5),te=function(e){var t=function(e){return e.moves.reduce((function(e,t){var n=e[t.from]||[];return Object(P.a)(Object(P.a)({},e),{},Object(V.a)({},t.from,[].concat(Object(ee.a)(n),[t])))}),{})}(e),n=function(e){return e.board.reduce((function(e,t){var n=t.squares.map((function(e,n){return{piece:e.piece,id:"".concat(e.file).concat(t.rank),isDark:t.rank%2?!(n%2):n%2}}));return[].concat(Object(ee.a)(e),Object(ee.a)(n))}),[])}(e);return Object(P.a)(Object(P.a)({},e),{},{squares:n,movesBySquare:t})};var ne={initializing:!0};var ae=n(11),re=[];var ce={selectedSquareId:null,pendingMove:null};var oe={chess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s:case d:return te(t.data.chess);default:return e}},appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case s:return{initializing:!1};case l:return{initializing:!1,errors:t.errors};default:return e}},gameLog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"EVENT_LOGGED":return[].concat(Object(ee.a)(e),[{time:Object(ae.a)(new Date,"HH:mm:ss"),message:t.data}]);default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIECE_SELECTED":var n=t.squareId===e.selectedSquareId;return Object(P.a)(Object(P.a)({},e),{},{selectedSquareId:n?null:t.squareId});case d:return Object(P.a)(Object(P.a)({},e),{},{pendingMove:null,selectedSquareId:null});case v:return Object(P.a)(Object(P.a)({},e),{},{pendingMove:t.data.variables.move});default:return e}}};function ie(e,t){return Object.entries(oe).reduce((function(n,r){var c=Object(a.a)(r,2),o=c[0],i=(0,c[1])(null===e||void 0===e?void 0:e[o],t);return Object(P.a)(Object(P.a)({},n),{},Object(V.a)({},o,i))}),e)}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ue(){var e=ie(void 0,{type:"INIT_STATE"}),t=Object(r.useReducer)(ie,e),n=Object(a.a)(t,2),o=n[0],i=n[1];return c.a.createElement(c.a.StrictMode,null,c.a.createElement(p.Provider,{value:o},c.a.createElement(b.Provider,{value:i},c.a.createElement(Z,null))))}i.a.render(c.a.createElement(ue,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[12,1,2]]]);
//# sourceMappingURL=main.fe9b06de.chunk.js.map