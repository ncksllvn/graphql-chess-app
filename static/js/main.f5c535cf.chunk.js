(this["webpackJsonpgraphql-chess-app"]=this["webpackJsonpgraphql-chess-app"]||[]).push([[0],{19:function(e,n,t){e.exports=t(34)},30:function(e,n,t){},31:function(e,n,t){},32:function(e,n,t){},34:function(e,n,t){"use strict";t.r(n);var a,c,r,o,s,i,u,l=t(0),b=t.n(l),p=t(9),m=t.n(p),f=t(4),d=t(3),v=t(18),O=(t(30),t(31),t(32),t(1)),j="chess-and-constants/REQUEST",h="chess-and-constants/RECEIVE",y="chess-and-constants/FAILURE",E="move/REQUEST",C="move/RECEIVE",g="move/FAILURE",S="BLACK",k="WHITE",q="KING",N="QUEEN",I="ROOK",A="BISHOP",w="KNIGHT",B="PAWN",P=(u={},Object(O.a)(u,q,(a={},Object(O.a)(a,S,"\u265a"),Object(O.a)(a,k,"\u2654"),a)),Object(O.a)(u,N,(c={},Object(O.a)(c,S,"\u265b"),Object(O.a)(c,k,"\u2655"),c)),Object(O.a)(u,I,(r={},Object(O.a)(r,S,"\u265c"),Object(O.a)(r,k,"\u2656"),r)),Object(O.a)(u,A,(o={},Object(O.a)(o,S,"\u265d"),Object(O.a)(o,k,"\u2657"),o)),Object(O.a)(u,w,(s={},Object(O.a)(s,S,"\u265e"),Object(O.a)(s,k,"\u2658"),s)),Object(O.a)(u,B,(i={},Object(O.a)(i,S,"\u265f"),Object(O.a)(i,k,"\u2659"),i)),u),L=S,T="\n  fragment ChessAttributes on Chess {\n      analysis {\n        bestMove {\n          from\n          to\n          flags\n        }\n        ponderMove {\n          from\n          to\n          flags\n        }\n      }\n      board {\n        rank\n        squares {\n          file\n          piece {\n            type\n            color\n          }\n        }\n      }\n      fen\n      gameOver\n      inCheck\n      inCheckmate\n      inDraw\n      inStalemate\n      insufficientMaterial\n      inThreefoldRepetition\n      moves {\n        color\n        from\n        to\n        promotion\n        flags\n      }\n      turn\n  }\n",R="\n  ".concat(T,"\n\n  fragment ColorConstants on Constants {\n    BLACK\n    WHITE\n  }\n\n  fragment PieceConstants on Constants {\n    BISHOP\n    KING\n    KNIGHT\n    PAWN\n    QUEEN\n    ROOK\n  }\n\n  fragment FlagConstants on Constants {\n    FLAGS {\n      NORMAL\n      CAPTURE\n      BIG_PAWN\n      EP_CAPTURE\n      PROMOTION\n      KSIDE_CASTLE\n      QSIDE_CASTLE\n    }\n  }\n\n  {\n    chess {\n      ... ChessAttributes\n    }\n\n    colorConstants: constants {\n      ... ColorConstants\n    }\n\n    pieceConstants: constants {\n      ... PieceConstants\n    }\n\n    flagConstants: constants {\n      ... FlagConstants\n    }\n  }\n"),x="\n  ".concat(T,"\n\n  mutation makeMove($fen: String!, $move: MoveObjectInput!){\n    chess: move (input: {\n      fen: $fen,\n      move: $move\n    }) {\n      ... ChessAttributes\n    }\n  }\n");function D(e){return{type:"PIECE_SELECTED",squareId:e}}function M(e,n){return Object(O.a)({},"CALL_API",{query:x,variables:{fen:e,move:n},types:[E,C,g]})}var H=t(2);function _(e){var n=e.squareId,t=e.piece,a=e.isDark,c=e.isActive,r=e.targetedBy,o=e.onClick,s=null,i="".concat(n," is empty"),u=["chess-board-square"];return a&&u.push("chess-board-square--dark"),t&&(i="".concat(n," contains a ").concat(t.colorName," ").concat(t.typeName),s=P[t.typeName][t.colorName],t.colorName===S&&u.push("chess-board-square--black-piece")),c&&(u.push("chess-board-square--active"),i="".concat(n," contains a ").concat(t.colorName," ").concat(t.typeName," selected for move."," "," Use the tab keys to select a square to initiate move."," "," Press again to cancel selection.")),r&&(u.push("chess-board-square--targeted"),i="Move ".concat(r.piece.typeName," on ").concat(r.id," ").concat(t?"to capture ".concat(t.typeName," on ").concat(n):"to ".concat(n))),b.a.createElement("button",{type:"button","aria-label":i,disabled:!o,className:u.join(" "),onClick:function(){return o(n)}},s)}function K(){var e=Object(d.b)(),n=Object(d.c)((function(e){return e.chess})),t=Object(d.c)((function(e){return e.constants})),a=Object(d.c)((function(e){return e.ui})),c=Object(l.useCallback)((function(n){return e(D(n))}),[e]),r=Object(l.useCallback)((function(c){var r=n.moves.filter((function(e){return e.from===a.selectedSquare.id})).find((function(e){return e.to===c})),o=r.from,s=r.to,i=r.promotion;i&&(i=t.pieceConstants[N]),e(M(n.fen,{from:o,to:s,promotion:i}))}),[e,n,t,a]);if(!n)return b.a.createElement("div",{className:"chess-board--loading"});var o=["chess-board"];return t.colorsBySymbol[n.turn]===S&&o.push("chess-board--black-turn"),b.a.createElement("div",{className:o.join(" ")},n.squares.map((function(e){var n,o,s,i=e.id,u=e.piece,l=e.isDark,p=i===(null===(n=a.selectedSquare)||void 0===n?void 0:n.id),m=null===(o=a.selectedSquare)||void 0===o||null===(s=o.targets)||void 0===s?void 0:s.includes(i),f=m?a.selectedSquare:null,d=m?r:u?c:null,v=u&&Object(H.a)({typeName:t.piecesBySymbol[u.type],colorName:t.colorsBySymbol[u.color]},u);return b.a.createElement(_,{key:i,piece:v,squareId:i,isDark:l,isActive:p,targetedBy:f,onClick:d})})))}function U(){return Object(d.c)((function(e){return e.appStatus})).loading?b.a.createElement("div",{className:"spinner"},b.a.createElement("div",{className:"spinner-icon"})):null}function W(){var e=Object(d.c)((function(e){return e.log}));return b.a.createElement("div",{className:"console",role:"log"},b.a.createElement("ul",{className:"console-output","aria-live":"polite","aria-atomic":"false"},null===e||void 0===e?void 0:e.map((function(e,n){return b.a.createElement("li",{key:n,className:"console-output-item"},e)}))))}function G(){var e=Object(d.b)();return Object(l.useEffect)((function(){e(Object(O.a)({},"CALL_API",{query:R,types:[j,h,y]}))}),[e]),b.a.createElement(b.a.Fragment,null,b.a.createElement(K,null),b.a.createElement(W,null),b.a.createElement(U,null))}var F=t(8),Q=t(7),$=t(15);function J(e){return Object.entries(e).reduce((function(e,n){var t=Object(Q.a)(n,2),a=t[0],c=t[1];return Object(H.a)(Object(O.a)({},c,a),e)}),{})}function V(e){return Object.entries(e).reduce((function(e,n){var t=Object(Q.a)(n,2),a=t[0],c=t[1];return Object(H.a)(Object(O.a)({},c,a),e)}),{})}function z(e){var n=function(e){return e.moves.reduce((function(e,n){var t=e[n.from]||[];return Object(H.a)(Object(H.a)({},e),{},Object(O.a)({},n.from,[].concat(Object(F.a)(t),[n])))}),{})}(e),t=function(e){return e.board.reduce((function(e,n){var t=n.squares.map((function(e,t){return{piece:e.piece,id:"".concat(e.file).concat(n.rank),isDark:n.rank%2?!(t%2):t%2}}));return[].concat(Object(F.a)(e),Object(F.a)(t))}),[])}(e);return Object(H.a)(Object(H.a)({},e),{},{squares:t,movesBySquare:n})}function X(e,n){var t;if(n===(null===(t=e.ui.selectedSquare)||void 0===t?void 0:t.id))return Object(H.a)(Object(H.a)({},e),{},{ui:{selectedSquareId:null}});var a=e.chess.squares.find((function(e){return e.id===n})),c=e.constants.piecesBySymbol[a.piece.type],r=e.constants.colorsBySymbol[a.piece.color],o=e.chess.movesBySquare[a.id],s=null===o||void 0===o?void 0:o.map((function(e){return e.to}));return{selectedSquare:Object(H.a)(Object(H.a)({},a),{},{targets:s,piece:Object(H.a)(Object(H.a)({},a.piece),{},{typeName:c,colorName:r})})}}function Y(e,n){var t=e.chess.squares.find((function(e){return e.id===n.from})),a=e.chess.squares.find((function(e){return e.id===n.to})),c=e.constants,r=c.piecesBySymbol,o=c.colorsBySymbol,s=function(e){return"".concat(o[e.color]," ").concat(r[e.type]).toLowerCase()},i="".concat(s(t.piece)," moves from ").concat(t.id," to ").concat(a.id);a.piece&&(i="".concat(i," to capture ").concat(s(a.piece)));var u=Object($.a)(new Date,"HH:mm:ss");return[].concat(Object(F.a)(e.log),["[".concat(u,"] ").concat(i)])}function Z(){var e=Object($.a)(new Date,"HH:mm:ss");return["[".concat(e,"] Game ready")]}var ee={appStatus:{loading:!0},chess:null,constants:null,ui:{selectedSquare:null},log:null};var ne=t(5),te=t.n(ne),ae=t(11),ce={"Content-Type":"application/json"};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var re=[function(){return function(e){return function(){var n=Object(ae.a)(te.a.mark((function n(t){var a,c,r,o,s,i,u,l,b,p,m,f,d,v,O;return te.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.CALL_API){n.next=2;break}return n.abrupt("return",e(t));case 2:return a=t.CALL_API,c=a.query,r=a.variables,o=Object(Q.a)(a.types,3),s=o[0],i=o[1],u=o[2],l={query:c,variables:r},b=JSON.stringify(l),p={method:"POST",headers:ce,body:b},e({type:s,data:{query:c,variables:r}}),n.prev=7,n.next=10,fetch("https://fast-castle-57354.herokuapp.com",p);case 10:if(!(m=n.sent).ok){n.next=20;break}return n.next=14,m.json();case 14:f=n.sent,d=f.data,v=f.errors,d&&e({type:i,data:d,variables:r}),v&&e({type:u,errors:v}),n.next=21;break;case 20:throw new Error("Response not ok");case 21:n.next=28;break;case 23:n.prev=23,n.t0=n.catch(7),O=n.t0,n.t0 instanceof Error&&(O={name:n.t0.name,message:n.t0.message,stack:n.t0.stack}),e({type:u,errors:[O]});case 28:case"end":return n.stop()}}),n,null,[[7,23]])})));return function(e){return n.apply(this,arguments)}}()}},function(e){return function(n){return function(){var t=Object(ae.a)(te.a.mark((function t(a){var c,r,o,s,i,u,l,b;return te.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n(a),a.type!==C){t.next=8;break}if(c=e.getState(),r=c.constants.colorConstants,o=c.chess,s=o.fen,i=o.turn,u=o.analysis.bestMove,l=u.from,b=u.to,i!==r[L]){t.next=8;break}return e.dispatch(D(l)),t.next=7,new Promise((function(e){return setTimeout(e,1e3)}));case 7:e.dispatch(M(s,{from:l,to:b}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}],oe=Object(v.composeWithDevTools)(f.applyMiddleware.apply(void 0,re)),se=Object(f.createStore)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,n=arguments.length>1?arguments[1]:void 0;switch(n.type){case j:case E:return Object(H.a)(Object(H.a)({},e),{},{appStatus:{loading:!0}});case h:var t=n.data,a=t.pieceConstants,c=t.colorConstants,r=t.flagConstants,o=t.chess;return Object(H.a)(Object(H.a)({},e),{},{ui:{selectedSquare:null},appStatus:{loading:!1},chess:z(o),constants:{piecesBySymbol:J(a),colorsBySymbol:V(c),pieceConstants:a,colorConstants:c,flagConstants:r},log:Z()});case"PIECE_SELECTED":return Object(H.a)(Object(H.a)({},e),{},{ui:X(e,n.squareId)});case C:return Object(H.a)(Object(H.a)({},e),{},{appStatus:{loading:!1},ui:{selectedSquare:null},chess:z(n.data.chess),log:Y(e,n.variables.move)});case y:return Object(H.a)(Object(H.a)({},e),{},{appStatus:{loading:!1,errors:n.errors}});default:return e}}),oe);m.a.render(b.a.createElement(b.a.StrictMode,null,b.a.createElement(d.a,{store:se},b.a.createElement(G,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[19,1,2]]]);
//# sourceMappingURL=main.f5c535cf.chunk.js.map