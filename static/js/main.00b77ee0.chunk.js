(this["webpackJsonpgraphql-chess-app"]=this["webpackJsonpgraphql-chess-app"]||[]).push([[0],{12:function(e,t,n){e.exports=n(20)},17:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(10),o=n.n(c),i=(n(17),n(18),"chess/REQUEST"),u="chess/RECEIVE",s="chess/FAILURE",l="move/REQUEST",v="move/RECEIVE",d="move/FAILURE",f="\n  fragment ChessAttributes on Chess {\n      analysis {\n        bestMove {\n          from\n          to\n          flags\n        }\n        ponderMove {\n          from\n          to\n          flags\n        }\n      }\n      board {\n        rank\n        squares {\n          file\n          piece {\n            type\n            color\n          }\n        }\n      }\n      fen\n      gameOver\n      inCheck\n      inCheckmate\n      inDraw\n      inStalemate\n      insufficientMaterial\n      inThreefoldRepetition\n      moves {\n        color\n        from\n        to\n        promotion\n        flags\n      }\n      turn\n  }\n",b="\n  ".concat(f,"\n  query Chess {\n    chess {\n      ... ChessAttributes\n    }\n  }\n"),m="\n  ".concat(f,"\n\n  mutation Move($fen: String!, $move: MoveObjectInput!){\n    chess: move (input: {\n      fen: $fen,\n      move: $move\n    }) {\n      ... ChessAttributes\n    }\n  }\n"),p=n(4),O=n.n(p),h=n(3),j=n(8),E=r.a.createContext(null);function g(){return Object(a.useContext)(E)}var k={"Content-Type":"application/json"};function y(){var e=g();return Object(a.useCallback)(function(){var t=Object(j.a)(O.a.mark((function t(n){var a,r,c,o,i,u,s,l,v,d,f,b,m,p,j;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n.query,r=n.variables,c=n.types,o=Object(h.a)(c,3),i=o[0],u=o[1],s=o[2],l={query:a,variables:r},v=JSON.stringify(l),d={method:"POST",headers:k,body:v},e({type:i,data:{query:a,variables:r}}),t.prev=6,t.next=9,fetch("https://fast-castle-57354.herokuapp.com",d);case 9:if(!(f=t.sent).ok){t.next=18;break}return t.next=13,f.json();case 13:b=t.sent,m=b.data,p=b.errors,e({type:u,data:m,errors:p}),t.next=19;break;case 18:throw new Error("Response not ok");case 19:t.next=26;break;case 21:t.prev=21,t.t0=t.catch(6),j=t.t0,t.t0 instanceof Error&&(j={name:t.t0.name,message:t.t0.message,stack:t.t0.stack}),e({type:s,errors:[j]});case 26:case"end":return t.stop()}}),t,null,[[6,21]])})));return function(e){return t.apply(this,arguments)}}(),[e])}var C={WHITE:"w",BLACK:"b"},q=new Map(Object.entries(C).map((function(e){var t=Object(h.a)(e,2),n=t[0];return[t[1],n]}))),I=C.WHITE,w=C.BLACK,T=C;function S(e){return e.appStatus}function A(e){return e.chess}function L(e){return e.gameLog}function N(e){return e.ui}var B=r.a.createContext(null);function M(e){var t=Object(a.useContext)(B);return r.a.useMemo((function(){return e(t)}),[e,t])}var K=n(2);function H(){var e=g(),t=M(A),n=M(N).activeSquareId,a=null===t||void 0===t?void 0:t.squares,c=null===t||void 0===t?void 0:t.movesBySquare;return[r.a.useMemo((function(){if(!n)return null;var e=a.find((function(e){return e.id===n})),t=c[e.id],r=new Set(null===t||void 0===t?void 0:t.map((function(e){return e.to})));return Object(K.a)(Object(K.a)({},e),{},{targets:r})}),[n,a,c]),r.a.useCallback((function(t){return e({type:"PIECE_SELECTED",squareId:t})}),[e])]}var x={PAWN:"p",KNIGHT:"n",BISHOP:"b",ROOK:"r",QUEEN:"q",KING:"k"},R=new Map(Object.entries(x).map((function(e){var t=Object(h.a)(e,2),n=t[0];return[t[1],n]}))),W=x;function P(){var e=y();return Object(a.useCallback)((function(t,n,a){var r=t.moves.find((function(e){return e.from===n&&e.to===a})),c=r.from,o=r.to,i=r.promotion;i&&(i=W.QUEEN),e({query:m,variables:{fen:t.fen,move:{from:c,to:o,promotion:i}},types:[l,v,d]})}),[e])}var D,G,U,z,Q,$,_,V=n(1),F=(_={},Object(V.a)(_,W.KING,(D={},Object(V.a)(D,T.BLACK,"\u265a"),Object(V.a)(D,T.WHITE,"\u2654"),D)),Object(V.a)(_,W.QUEEN,(G={},Object(V.a)(G,T.BLACK,"\u265b"),Object(V.a)(G,T.WHITE,"\u2655"),G)),Object(V.a)(_,W.ROOK,(U={},Object(V.a)(U,T.BLACK,"\u265c"),Object(V.a)(U,T.WHITE,"\u2656"),U)),Object(V.a)(_,W.BISHOP,(z={},Object(V.a)(z,T.BLACK,"\u265d"),Object(V.a)(z,T.WHITE,"\u2657"),z)),Object(V.a)(_,W.KNIGHT,(Q={},Object(V.a)(Q,T.BLACK,"\u265e"),Object(V.a)(Q,T.WHITE,"\u2658"),Q)),Object(V.a)(_,W.PAWN,($={},Object(V.a)($,T.BLACK,"\u265f"),Object(V.a)($,T.WHITE,"\u2659"),$)),_);function J(e){var t=q.get(e.color),n=R.get(e.type);return"".concat(t," ").concat(n).toLowerCase()}var X=r.a.memo((function(e){var t=e.squareId,n=e.piece,a=e.isDark,c=e.isActive,o=e.targetedBy,i=e.onClick,u=null,s="".concat(t," is empty"),l=["chess-board-square","chess-board-square--".concat(t)];return a&&l.push("chess-board-square--dark"),i&&l.push("chess-board-square--clickable"),n&&(u=F[n.type][n.color],s="".concat(t," contains a ").concat(J(n)),n.color===T.BLACK&&l.push("chess-board-square--black-piece")),c&&(l.push("chess-board-square--active"),s="".concat(t," contains a ").concat(J(n)," selected for move."," "," Use the tab keys to select a square to initiate move."," "," Press again to cancel selection.")),o&&(l.push("chess-board-square--targeted"),s="Move ".concat(J(o.piece)," on ").concat(o.id," ").concat(n?"to capture ".concat(J(n)," on ").concat(t):"to ".concat(t))),r.a.createElement("button",{type:"button","data-testid":t,"aria-label":s,"aria-pressed":c,disabled:!i,className:l.join(" "),onClick:i?function(){return i(t)}:null},u)}));function Y(){var e=M(A),t=H(),n=Object(h.a)(t,2),a=n[0],c=n[1],o=P();if(!e)return r.a.createElement("div",{className:"chess-board--loading","data-testid":"chess-board--loading"},"Loading...");var i=["chess-board"];e.turn===T.BLACK&&i.push("chess-board--black-turn");var u=e.turn===I;return r.a.createElement("div",{className:i.join(" "),"data-testid":"chess-board"},e.squares.map((function(t){var n,i=t.id,s=t.piece,l=t.isDark,v=i===(null===a||void 0===a?void 0:a.id),d=null===a||void 0===a||null===(n=a.targets)||void 0===n?void 0:n.has(i),f=d?a:null,b=null;return u&&(d?b=function(t){return o(e,a.id,t)}:(null===s||void 0===s?void 0:s.color)===I&&(b=function(e){return c(e)})),r.a.createElement(X,{key:i,piece:s,squareId:i,isDark:l,isActive:v,targetedBy:f,onClick:b})})))}function Z(){var e=M(L),t=Object(a.useRef)(null);return function(){var e=g(),t=M(S),n=M(A),r=M(N),c=Object(a.useCallback)((function(t){e({type:"EVENT_LOGGED",data:t})}),[e]),o=Object(a.useCallback)((function(e){var t=n.squares.find((function(t){return t.id===e.from})),a=n.squares.find((function(t){return t.id===e.to})),r=null;r=a.piece?"\n          ".concat(q.get(t.piece.color)," ").concat(R.get(t.piece.type)," on ").concat(t.id," captures ").concat(R.get(a.piece.type)," on ").concat(a.id):"\n          ".concat(q.get(t.piece.color)," ").concat(R.get(t.piece.type)," moves from ").concat(t.id," to ").concat(a.id),c(r)}),[n,c]),i=null===n||void 0===n?void 0:n.inCheckmate,u=null===n||void 0===n?void 0:n.inCheck;Object(a.useEffect)((function(){t.initializing?c("initializing game..."):c("game ready")}),[c,t.initializing]),Object(a.useEffect)((function(){r.pendingMove&&o(r.pendingMove)}),[r.pendingMove,o]),Object(a.useEffect)((function(){i?c("".concat(q.get(n.turn)," is in checkmate")):u&&c("".concat(q.get(n.turn)," is in check"))}),[i,u,c])}(),function(e,t){Object(a.useEffect)((function(){e.current.scrollTop=e.current.scrollHeight}),[e,t])}(t,e),r.a.createElement("div",{ref:t,className:"console",role:"log"},r.a.createElement("ul",{className:"console-output","aria-live":"polite","aria-atomic":"false"},null===e||void 0===e?void 0:e.map((function(e,t){return r.a.createElement("li",{key:t,className:"console-output-item"},"[",r.a.createElement("time",{dateTime:e.time},e.time),"] ",e.message)}))))}function ee(){return function(){var e=y();Object(a.useEffect)((function(){e({query:b,types:[i,u,s]})}),[e])}(),function(){var e=M(A),t=null===e||void 0===e?void 0:e.turn,n=null===e||void 0===e?void 0:e.gameOver,r=H(),c=Object(h.a)(r,2)[1],o=P(),i=Object(a.useCallback)(Object(j.a)(O.a.mark((function t(){var n,a,r,i;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.moves,r=e.analysis,i=null!==(n=null===r||void 0===r?void 0:r.bestMove)&&void 0!==n?n:a[0],c(i.from),t.next=5,new Promise((function(e){return setTimeout(e,1e3)}));case 5:o(e,i.from,i.to);case 6:case"end":return t.stop()}}),t)}))),[e,c,o]);Object(a.useEffect)((function(){n||t!==w||i()}),[i,n,t])}(),r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,null),r.a.createElement(Z,null))}var te=n(5),ne=function(e){var t=function(e){return e.moves.reduce((function(e,t){var n=e[t.from]||[];return Object(K.a)(Object(K.a)({},e),{},Object(V.a)({},t.from,[].concat(Object(te.a)(n),[t])))}),{})}(e),n=function(e){return e.board.reduce((function(e,t){var n=t.squares.map((function(e,n){return{piece:e.piece,id:"".concat(e.file).concat(t.rank),isDark:t.rank%2?!(n%2):n%2}}));return[].concat(Object(te.a)(e),Object(te.a)(n))}),[])}(e);return Object(K.a)(Object(K.a)({},e),{},{squares:n,movesBySquare:t})};var ae={initializing:!0};var re=n(11),ce=[];var oe={activeSquareId:null,pendingMove:null};var ie={chess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:case v:return ne(t.data.chess);default:return e}},appStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return{initializing:!1};case s:return{initializing:!1,errors:t.errors};default:return e}},gameLog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"EVENT_LOGGED":return[].concat(Object(te.a)(e),[{time:Object(re.a)(new Date,"HH:mm:ss"),message:t.data}]);default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIECE_SELECTED":var n=t.squareId===e.activeSquareId;return Object(K.a)(Object(K.a)({},e),{},{activeSquareId:n?null:t.squareId});case v:return Object(K.a)(Object(K.a)({},e),{},{pendingMove:null,activeSquareId:null});case l:return Object(K.a)(Object(K.a)({},e),{},{pendingMove:t.data.variables.move});default:return e}}};function ue(e,t){return Object.entries(ie).reduce((function(n,a){var r=Object(h.a)(a,2),c=r[0],o=(0,r[1])(null===e||void 0===e?void 0:e[c],t);return Object(K.a)(Object(K.a)({},n),{},Object(V.a)({},c,o))}),e)}function se(e){var t=e.children,n=ue(void 0,{type:"INIT_STATE"}),c=Object(a.useReducer)(ue,n),o=Object(h.a)(c,2),i=o[0],u=o[1];return r.a.createElement(B.Provider,{value:i},r.a.createElement(E.Provider,{value:u},t))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(se,null,r.a.createElement(ee,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[12,1,2]]]);
//# sourceMappingURL=main.00b77ee0.chunk.js.map